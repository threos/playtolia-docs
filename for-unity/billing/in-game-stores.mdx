---
title: "In-game Stores"
description: "Learn how to setup the backend of your in-game store within minutes using PlaytoliaStore"
---

### Requirements

- Playtolia SDK (with Authentication and Billing enabled)

### Store API

Playtolia Store API allows you to list, query, and search store items. Store API supports different types of items such as `non-consumables`, `consumables`, and `subscriptions`. Store API also provides a simple function to start the purchase flow for any item in your store. Store API works with Play Store and App Store APIs in order to securely process payments, grant items to your players, and handle failures.

### List all available items

Import the PlaytoliaSDK.Runtime to your script by adding the using directive

```c# StoreController.cs
using PlaytoliaSDK.Runtime;
```

Call the **GetItems** function to retrieve all available store items

```c# StoreController.cs
// All items
var allItems = PlaytoliaStore.GetItems();
```

<Warning>
  Make sure your player is authenticated before calling GetItems or any other PlaytoliaStore function. Store API requires authentication and will return empty lists or null values until the Store API can successfully log in and fetch the items from the remote server.
</Warning>

<Info>
  Once you authenticate your user, PlaytoliaStore will automatically refresh and fetch the latest available items. If you need to refresh the store items manually, simply use **PlaytoliaStore.Refresh()** function.
</Info>

### Searching

Call the **SearchItems** function to search items by their name, description, or SKU

```c# StoreController.cs
// Search for items with "Gold" in their name, description, or sku
var searchResult = PlaytoliaStore.SearchItems("Gold");
```

### Get an item

PlaytoliaStore includes two getter functions to help you get a specific StoreItem by item ID or SKU

```c# StoreController.cs
// Get an item by ID
var itemById = PlaytoliaStore.GetItemById("gold_500");

// Get an item by SKU
var itemBySku = PlaytoliaStore.GetItemBySku("com.mygame.coinpack_500");
```

## Purchases

### Make a purchase

When your player is ready to purchase an item, simply use the **BeginPurchaseFlow** function and pass a StoreItem

```c# StoreController.cs
StoreItem item = PlaytoliaStore.GetItemBySku("com.mygame.coinpack_500");
PlaytoliaStore.BeginPurchaseFlow(item);
```

### Handle the result

Purchase flows are a composition of several requests:

1. Client calls to App Store or Google Play Store to make sure the billing is available, fetch the item, and display the IAP dialog.
2. A verification call to Playtolia servers, to check the integrity of the purchase and update user wallets, subscriptions, and entitlements.
3. A final call to the billing clients to acknowledge (or consume) the purchase.

The SDK makes all necessary requests and calls with a single BeginPurchaseFlow function. Most of the process is handled in different threads in an asynchronous manner, in order to prevent your game from lagging or freezing.

All of this is managed in Playtolia.Core, which is outside the Unity/C# scope where your code runs. Therefore, you cannot simply use the BeginPurchaseFlow result directly, as it returns instantly regardless of the status.

**EventBus** component offers a fast, non-blocking, and safe way to consume results of async flows by storing and passing references of local callback objects named EventHandles.

### Using EventBus to handle IAP results

Simply create an EventHandle with your success and error callbacks

```c#
var onSuccess = (Packet p) => {
	ShowPurchaseSuccessfulDialog();
};

var onError = (Packet p) => {
	SDKResult r = (SDKResult) p.Data;
	var message = r.Message;
	Debug.Log("Purchase failed: " + message);
};

var handle = EventBus.Register(onSuccess, onError);
```

We have now created an EventHandle. However it is not registered and can not be called, yet. In order to make our handle functional, we have to provide the handle along with our BeginPurchaseFlow call.

```c#
StoreItem item = PlaytoliaStore.GetItemBySku("com.mygame.coinpack_500");
PlaytoliaStore.BeginPurchaseFlow(item, handle); // notice the 'handle' parameter
```

Now we are ready to receive callbacks from our purchase flow. You can use the SDKResult from the Packet object that is provided for both callbacks to retrieve more information about the errors or requests. Even native errors are wrapped in a SDKResult object to make the logging and error handling straightforward.